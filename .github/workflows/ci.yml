name: CI/CD Pipeline - Biblioteca DAM

on:
  push:
    branches: [ "main" ]  # Se ejecuta al hacer push a la rama "main"

jobs:
  build-and-test:
    name: Build i Anàlisi de Qualitat
    runs-on: windows-latest

    steps:
    - uses: actions/checkout@v4  # Baja el código del repositorio

    - name: Configurar .NET SDK
      uses: actions/setup-dotnet@v4
      with:
        dotnet-version: 8.0.x  # Cambia por la versión que uses (6.0.x, 7.0.x, etc.)

    - name: Restaurar dependències
      working-directory: BibliotecaDemo
      run: dotnet restore

    - name: Compilar el projecte
      working-directory: BibliotecaDemo
      run: dotnet build --configuration Release --no-restore

    - name: Executar tests
      working-directory: BibliotecaDemo
      run: dotnet test --no-build --verbosity normal

    - name: Publicar el projecte
      working-directory: BibliotecaDemo
      run: dotnet publish --configuration Release --output ./publish